<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>H8 - O ticket médio (por cliente por compra) aumenta em datas especiais/comemorativas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="h8_ticket_medio_files/libs/clipboard/clipboard.min.js"></script>
<script src="h8_ticket_medio_files/libs/quarto-html/quarto.js"></script>
<script src="h8_ticket_medio_files/libs/quarto-html/popper.min.js"></script>
<script src="h8_ticket_medio_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="h8_ticket_medio_files/libs/quarto-html/anchor.min.js"></script>
<link href="h8_ticket_medio_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="h8_ticket_medio_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="h8_ticket_medio_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="h8_ticket_medio_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="h8_ticket_medio_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">H8 - O ticket médio (por cliente por compra) aumenta em datas especiais/comemorativas</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="carregando-os-dados-necessários" class="level2">
<h2 class="anchored" data-anchor-id="carregando-os-dados-necessários">Carregando os dados necessários</h2>
<div id="23aef625" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> DataFrame, read_csv, to_datetime, concat</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> os <span class="im">import</span> path</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>datadir <span class="op">=</span> <span class="st">'C:/Users/User/Desktop/data_science/mentoria_data_mundo/projeto_ecommerce/_data/clean'</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>df_clientes <span class="op">=</span> read_csv(path.join(datadir, <span class="st">'e_commerce_clientes.csv'</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>df_carrinhos <span class="op">=</span> read_csv(path.join(datadir, <span class="st">'e_commerce_carrinhos.csv'</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>df_pedidos <span class="op">=</span> read_csv(path.join(datadir, <span class="st">'e_commerce_pedidos.csv'</span>))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>df_pedidos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">data</th>
<th data-quarto-table-cell-role="th">data_pagamento</th>
<th data-quarto-table-cell-role="th">data_cancelamento</th>
<th data-quarto-table-cell-role="th">numero_pedido</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">pagamento</th>
<th data-quarto-table-cell-role="th">produto</th>
<th data-quarto-table-cell-role="th">sku</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">entrega_cidade</th>
<th data-quarto-table-cell-role="th">entrega_estado</th>
<th data-quarto-table-cell-role="th">entrega_cep</th>
<th data-quarto-table-cell-role="th">utm_source</th>
<th data-quarto-table-cell-role="th">utm_campaign</th>
<th data-quarto-table-cell-role="th">utm_medium</th>
<th data-quarto-table-cell-role="th">utm_content</th>
<th data-quarto-table-cell-role="th">utm_term</th>
<th data-quarto-table-cell-role="th">customizacao</th>
<th data-quarto-table-cell-role="th">id_cliente</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>117569438</td>
<td>04/08/2024 18:26:40</td>
<td>04/08/2024 18:27</td>
<td>NaN</td>
<td>1042552530523300</td>
<td>Pagamento aprovado</td>
<td>Pix</td>
<td>BRACELETE AJUSTÁVEL O COM COROA</td>
<td>DFREFSP8P</td>
<td>...</td>
<td>Brasilia</td>
<td>Distrito Federal</td>
<td>72455490</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>31d69aed10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>117385907</td>
<td>01/08/2024 19:08:02</td>
<td>01/08/2024 19:11</td>
<td>NaN</td>
<td>1042552893870166</td>
<td>Pagamento aprovado</td>
<td>Pix</td>
<td>BRACELETE AJUSTÁVEL O COM COROA</td>
<td>DFREFSP8P</td>
<td>...</td>
<td>Varzea Nova(Santa Rita)</td>
<td>Paraiba</td>
<td>58304500</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3e109eedd5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>117385794</td>
<td>01/08/2024 19:05:53</td>
<td>NaN</td>
<td>01/08/2024 19:12</td>
<td>1042552190094688</td>
<td>Cancelado</td>
<td>Pix</td>
<td>BRACELETE AJUSTÁVEL O COM COROA</td>
<td>DFREFSP8P</td>
<td>...</td>
<td>Varzea Nova(Santa Rita)</td>
<td>Paraiba</td>
<td>58304500</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3e109eedd5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>117382873</td>
<td>01/08/2024 18:12:14</td>
<td>NaN</td>
<td>01/08/2024 19:13</td>
<td>1042552273445602</td>
<td>Cancelado</td>
<td>Pix</td>
<td>BRACELETE AJUSTÁVEL O COM COROA</td>
<td>DFREFSP8P</td>
<td>...</td>
<td>Varzea Nova(Santa Rita)</td>
<td>Paraiba</td>
<td>58304500</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3e109eedd5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>117382771</td>
<td>01/08/2024 18:09:41</td>
<td>NaN</td>
<td>01/08/2024 19:13</td>
<td>1042552782939597</td>
<td>Cancelado</td>
<td>Pix</td>
<td>BRACELETE AJUSTÁVEL O COM COROA</td>
<td>DFREFSP8P</td>
<td>...</td>
<td>Varzea Nova(Santa Rita)</td>
<td>Paraiba</td>
<td>58304500</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3e109eedd5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">140</td>
<td>141</td>
<td>112676891</td>
<td>22/05/2024 13:22:56</td>
<td>22/05/2024 13:22</td>
<td>22/05/2024 13:27</td>
<td>1042552727006222</td>
<td>Cancelado</td>
<td>Cartão de crédito</td>
<td>Teste</td>
<td>4P8E3PJHB</td>
<td>...</td>
<td>Florianopolis</td>
<td>Santa Catarina</td>
<td>88058000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0db3cf4f27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">141</td>
<td>142</td>
<td>112676767</td>
<td>22/05/2024 13:21:14</td>
<td>NaN</td>
<td>22/05/2024 15:01</td>
<td>1042552431219898</td>
<td>Cancelado</td>
<td>Pix</td>
<td>Teste</td>
<td>4P8E3PJHB</td>
<td>...</td>
<td>Florianopolis</td>
<td>Santa Catarina</td>
<td>88058000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0db3cf4f27</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">142</td>
<td>143</td>
<td>112675088</td>
<td>22/05/2024 12:54:55</td>
<td>NaN</td>
<td>22/05/2024 14:45</td>
<td>1042552609058447</td>
<td>Cancelado</td>
<td>Pix</td>
<td>BRINCO ARGOLA SOL E LUA</td>
<td>JRM3YWN95</td>
<td>...</td>
<td>Florianopolis</td>
<td>Santa Catarina</td>
<td>88058000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0db3cf4f27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">143</td>
<td>144</td>
<td>112670127</td>
<td>22/05/2024 11:37:57</td>
<td>22/05/2024 11:37</td>
<td>22/05/2024 11:47</td>
<td>1042552577521467</td>
<td>Cancelado</td>
<td>Cartão de crédito</td>
<td>Teste</td>
<td>JMPBRU537</td>
<td>...</td>
<td>Florianopolis</td>
<td>Santa Catarina</td>
<td>88058000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0db3cf4f27</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">144</td>
<td>145</td>
<td>112669238</td>
<td>22/05/2024 11:23:14</td>
<td>NaN</td>
<td>28/05/2024 17:09</td>
<td>1042552155461445</td>
<td>Cancelado</td>
<td>Pix</td>
<td>BRINCO ARGOLA SOL E LUA</td>
<td>JRM3YWN95</td>
<td>...</td>
<td>Florianopolis</td>
<td>Santa Catarina</td>
<td>88058000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0db3cf4f27</td>
</tr>
</tbody>
</table>

<p>145 rows × 35 columns</p>
</div>
</div>
</div>
<p>OBS: ao verificarmos quantos clientes ativos temos através da colunas ativos usando df_clientes.query(“ativo == ‘sim’”), temos uma quantidade incorreta de clientes ativos, mostrando 83 de 84, sendo que, ao verificarmos a quantidade de clientes únicos através do dataset de pedidos temos 43 clientes que fizeram pedidos.</p>
</section>
<section id="realizando-os-tratamentos-dos-dados-necessários-em-df_pedidos" class="level2">
<h2 class="anchored" data-anchor-id="realizando-os-tratamentos-dos-dados-necessários-em-df_pedidos">Realizando os tratamentos dos dados necessários em df_pedidos:</h2>
<p>Do dataframe ‘df_pedidos’ Iremos pegar a coluna ‘total_pago’ e a coluna ‘id_cliente’, assim teremos o valor total pago por cliente, além da data. A ideia é dividir em dois grupos, o ticket médio dos clientes em datas normais, e em datas especiais.</p>
<div id="ed670f81" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trocando as ',' por '.' para converter para float na coluna 'total_pago'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df_pedidos[<span class="st">'total_pago'</span>] <span class="op">=</span> (df_pedidos[<span class="st">'total_pago'</span>]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> .replace(<span class="st">','</span>, <span class="st">'.'</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'total_pago'</span>: <span class="bu">float</span>}))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Trocando o tipo da coluna 'data' para datetime (formato do pandas para datas)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>df_pedidos[<span class="st">'data'</span>] <span class="op">=</span> to_datetime(df_pedidos[<span class="st">'data'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M:%S'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>df_pedidos[<span class="st">'data'</span>] <span class="op">=</span> df_pedidos[<span class="st">'data'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.strftime(<span class="st">'%Y/%m/</span><span class="sc">%d</span><span class="st">'</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrando apenas as colunas necessárias do dataframe 'df_pedidos'</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>df_pedidos <span class="op">=</span> df_pedidos.<span class="bu">filter</span>([<span class="st">'id_cliente'</span>, <span class="st">'total_pago'</span>, <span class="st">'data'</span>])</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>df_pedidos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id_cliente</th>
<th data-quarto-table-cell-role="th">total_pago</th>
<th data-quarto-table-cell-role="th">data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>31d69aed10</td>
<td>508.90</td>
<td>2024/08/04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3e109eedd5</td>
<td>518.90</td>
<td>2024/08/01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3e109eedd5</td>
<td>518.90</td>
<td>2024/08/01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3e109eedd5</td>
<td>518.90</td>
<td>2024/08/01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3e109eedd5</td>
<td>518.90</td>
<td>2024/08/01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">140</td>
<td>0db3cf4f27</td>
<td>14.53</td>
<td>2024/05/22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">141</td>
<td>0db3cf4f27</td>
<td>13.50</td>
<td>2024/05/22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">142</td>
<td>0db3cf4f27</td>
<td>139.30</td>
<td>2024/05/22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">143</td>
<td>0db3cf4f27</td>
<td>34.90</td>
<td>2024/05/22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">144</td>
<td>0db3cf4f27</td>
<td>149.21</td>
<td>2024/05/22</td>
</tr>
</tbody>
</table>

<p>145 rows × 3 columns</p>
</div>
</div>
</div>
</section>
<section id="criando-df_pedidos-com-datas-especiais-e-não-especiais" class="level2">
<h2 class="anchored" data-anchor-id="criando-df_pedidos-com-datas-especiais-e-não-especiais">Criando df_pedidos com datas especiais e não especiais</h2>
<div id="5ba82c35" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos criar a lista com as datas especiais</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>datas_especiais <span class="op">=</span> ([</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024/01/01'</span>, <span class="st">'2024/01/06'</span>, <span class="st">'2024/01/25'</span>, <span class="st">'2024/02/10'</span>, <span class="st">'2024/02/11'</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024/02/12'</span>, <span class="st">'2024/02/13'</span>, <span class="st">'2024/02/14'</span>, <span class="st">'2024/02/24'</span>, <span class="st">'2024/03/08'</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024/03/10'</span>, <span class="st">'2024/03/19'</span>, <span class="st">'2024/03/29'</span>, <span class="st">'2024/04/01'</span>, <span class="st">'2024/04/21'</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024/04/22'</span>, <span class="st">'2024/04/25'</span>, <span class="st">'2024/04/30'</span>, <span class="st">'2024/05/01'</span>, <span class="st">'2024/05/13'</span>, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024/05/31'</span>, <span class="st">'2024/06/05'</span>, <span class="st">'2024/06/12'</span>, <span class="st">'2024/06/24'</span>, <span class="st">'2024/07/02'</span>, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024/07/09'</span>, <span class="st">'2024/07/20'</span>, <span class="st">'2024/08/11'</span>, <span class="st">'2024/08/15'</span>, <span class="st">'2024/08/19'</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024/09/07'</span>, <span class="st">'2024/09/29'</span>, <span class="st">'2024/10/12'</span>, <span class="st">'2024/10/15'</span>, <span class="st">'2024/10/28'</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2024/11/02'</span>, <span class="st">'2024/11/15'</span>, <span class="st">'2024/11/20'</span>, <span class="st">'2024/12/24'</span>, <span class="st">'2024/12/25'</span>, <span class="st">'2024/12/31'</span>])</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Agora criaremos outro dataframe apenas com as datas_especiais e um com datas normais</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>df_pedidos_datas_especiais <span class="op">=</span> df_pedidos[df_pedidos[<span class="st">'data'</span>].isin(datas_especiais)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>df_pedidos_datas_normais <span class="op">=</span> df_pedidos[df_pedidos[<span class="st">'data'</span>].isin(datas_especiais) <span class="op">==</span> <span class="va">False</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analisando-grupos" class="level2">
<h2 class="anchored" data-anchor-id="analisando-grupos">Analisando grupos</h2>
<div id="d9bd958a" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_pedidos_datas_especiais</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id_cliente</th>
<th data-quarto-table-cell-role="th">total_pago</th>
<th data-quarto-table-cell-role="th">data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>69ae2c2675</td>
<td>142.90</td>
<td>2024/07/09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>69ae2c2675</td>
<td>291.90</td>
<td>2024/07/09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>69ae2c2675</td>
<td>291.90</td>
<td>2024/07/09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>69ae2c2675</td>
<td>637.90</td>
<td>2024/07/09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>69ae2c2675</td>
<td>637.90</td>
<td>2024/07/09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>f3d6007fb0</td>
<td>464.90</td>
<td>2024/07/09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>f3d6007fb0</td>
<td>464.90</td>
<td>2024/07/09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>bd425d1832</td>
<td>577.00</td>
<td>2024/06/12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>bd425d1832</td>
<td>577.00</td>
<td>2024/06/12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>bd425d1832</td>
<td>577.00</td>
<td>2024/06/12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>af067145fb</td>
<td>619.09</td>
<td>2024/06/12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>af067145fb</td>
<td>619.09</td>
<td>2024/06/12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>af067145fb</td>
<td>619.09</td>
<td>2024/06/12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>6d89f121b2</td>
<td>607.00</td>
<td>2024/06/12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>6d89f121b2</td>
<td>607.00</td>
<td>2024/06/12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>6d89f121b2</td>
<td>607.00</td>
<td>2024/06/12</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="0f6fb45e" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_pedidos_datas_normais</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id_cliente</th>
<th data-quarto-table-cell-role="th">total_pago</th>
<th data-quarto-table-cell-role="th">data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>31d69aed10</td>
<td>508.90</td>
<td>2024/08/04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3e109eedd5</td>
<td>518.90</td>
<td>2024/08/01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3e109eedd5</td>
<td>518.90</td>
<td>2024/08/01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3e109eedd5</td>
<td>518.90</td>
<td>2024/08/01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3e109eedd5</td>
<td>518.90</td>
<td>2024/08/01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">124</td>
<td>0db3cf4f27</td>
<td>14.53</td>
<td>2024/05/22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">125</td>
<td>0db3cf4f27</td>
<td>13.50</td>
<td>2024/05/22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">126</td>
<td>0db3cf4f27</td>
<td>139.30</td>
<td>2024/05/22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">127</td>
<td>0db3cf4f27</td>
<td>34.90</td>
<td>2024/05/22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">128</td>
<td>0db3cf4f27</td>
<td>149.21</td>
<td>2024/05/22</td>
</tr>
</tbody>
</table>

<p>129 rows × 3 columns</p>
</div>
</div>
</div>
<div id="8a0b7885" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos criar os grupos com o ticket médio de cada cliente</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ticket_medio_especiais <span class="op">=</span> df_pedidos_datas_especiais.groupby(<span class="st">'id_cliente'</span>)[<span class="st">'total_pago'</span>].mean()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ticket_medio_normais <span class="op">=</span> df_pedidos_datas_normais.groupby(<span class="st">'id_cliente'</span>)[<span class="st">'total_pago'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d8772831" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ticket_medio_especiais <span class="co"># Limitação com apenas 5 linhas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>id_cliente
69ae2c2675    400.50
6d89f121b2    607.00
af067145fb    619.09
bd425d1832    577.00
f3d6007fb0    464.90
Name: total_pago, dtype: float64</code></pre>
</div>
</div>
<div id="04f8e026" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ticket_medio_normais</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>id_cliente
0220acd6a2    166.900000
0db3cf4f27     70.288000
109b4796fb    525.890000
1c21b7936a    185.900000
20b59787f0    318.470000
25a073ec7e    121.440000
31d69aed10    508.900000
3945c23d9d    386.000000
3c4f7f5500    506.850000
3d733877be    234.960000
3e109eedd5    518.900000
44084680ed    186.820000
45edbd16cf    365.325714
49963620ad    153.020000
4f62898592    168.900000
5750bce6a8    290.210000
58cce37349    379.840000
670d1fc5e4    136.500000
68a244dc63    259.460000
75a57b5380    238.290000
7b4fa02eda    339.035000
82b202fdb5    461.250000
8822bf59c1    322.040000
952b97a1ec    386.951429
a01aae65a5    490.269333
a57565d68a    362.802500
af067145fb    393.000000
c3de12c313    507.680000
c9233b915e    362.310000
ce08f9bda2    168.900000
d1aacacb7f    296.300000
d9c52cd22c    393.000000
dc1ba1366f    159.510000
dcef5308d0    870.313077
ddef8dfacc    418.900000
dee4105753    131.660000
ebd181dfc4    182.660000
f026eb1e16    200.770000
f3d6007fb0    374.487500
fe8e6062bc    132.810000
Name: total_pago, dtype: float64</code></pre>
</div>
</div>
<p>No código acima, percebemos que df_pedidos_datas_especiais temos uma limitação, pois temos uma amostra relativamente pequena, contendo apenas 5 clientes de 43 enquanto que no de datas normais temos 40 linhas, ou seja, uma diferença de 8x no tamanho da amostra.</p>
</section>
<section id="realizando-teste-de-normalidade-e-teste-de-hipótese" class="level2">
<h2 class="anchored" data-anchor-id="realizando-teste-de-normalidade-e-teste-de-hipótese">Realizando teste de normalidade e teste de hipótese</h2>
<p>Agora, como queremos comparar a variável ‘ticket médio’ entre dois grupos, e ela é contínua. Com isso, iremos usar o teste t two sample se for normalmente distribuida (paramétrico), ou o teste de mann whitney u se não for paramétrico.</p>
<div id="4ca0408c" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Primeiramente vamos testar a normalidade usando o teste de shapiro.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> shapiro</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>res_especiais <span class="op">=</span> shapiro(ticket_medio_especiais)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>res_normais <span class="op">=</span> shapiro(ticket_medio_normais)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(res_especiais.pvalue)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(res_normais.pvalue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.271522730038582
0.006793495089499543</code></pre>
</div>
</div>
<p>Nesse caso, como os p-valores estão dando resultados diferentes, sendo um para teste paramétrico e outro para não paramétrico, iremos considerar o que tem o maior tamanho amostral, ou seja, o p-valor de datas normais, que é 8x maior que o de datas especiais. Portanto, o p-valor é 0,6%, o que é menor que 5%, resultando em um teste não paramétrico. Vamos usar o Wilcoxon Rank Sum (ou Mann Whitney U).</p>
<div id="51a5f1a0" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> mannwhitneyu</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>_, p_valor <span class="op">=</span> mannwhitneyu(ticket_medio_normais, ticket_medio_especiais)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p_valor)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ticket_medio_normais.median())</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ticket_medio_especiais.median())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.003643188194802698
320.255
577.0</code></pre>
</div>
</div>
</section>
<section id="conclusão" class="level2">
<h2 class="anchored" data-anchor-id="conclusão">Conclusão</h2>
<p>A partir do resultado acima, o p-valor do teste de mannwhitneyu, que prova a hipótese de que as duas distribuições são iguais, ou seja, que não há uma diferença significativa entre os valores dos tickets médios, deu 0,36%, ou seja, teve sua hipótese rejeitada, mostrando que há uma diferença signnificativa entre os dois grupos, o de ticket médio em datas especiais e o de ticket médio em datas normais. Para isso, comparamos agora as medianas entre eles, e verificamos que a mediana do ticket médio em datas normais é menor. Com isso podemos concluir a partir desse teste que o ticket médio em datas especiais é maior.</p>
<p>Para confirmar isso, vamos realizar o teste de Wilcoxon Rank Sum (Mann Whitney U) no método alternativo “less”, ou seja, que prova a hipótese de que o grupo 1 (ticket médio em datas normais) é menor que o grupo 2 (ticket médio em datas especiais):</p>
<div id="0e998490" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>_, p_valor_less <span class="op">=</span> mannwhitneyu(ticket_medio_normais, ticket_medio_especiais, alternative<span class="op">=</span><span class="st">"less"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p_valor_less)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.001821594097401349</code></pre>
</div>
</div>
<p>Nesse teste, como a hipótese teve um p-valor aproximado de 0,183%, assumindo um valor de corte de 5%, assumimos que a hipótese foi rejeitada, o que mostra que a distribuição do ticket médio em datas normais na verdade é maior do que o do ticket médio em datas especiais. Com isso, nosso segundo teste de Mann Whitney U foi contrastante com o primeiro, o que torna a hipótese inconclusiva. Isso provavelmente aconteceu devido ao tamanho da amostra, uma limitação proveniente dos dados fornecidos.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>